SELECT
*,
(TOTAL_NUMBER_OF_TRANSERS_TO + TOTAL_NUMBER_OF_TRANSERS_FROM) TOTAL_NUMBER_OF_TRANSERS
FROM (
	SELECT
	  F.NAME,
	  F.ADDRESS,
	  F.TYPE,
	  F.Telephone PHONE,
	  SUM(if(ER.endDate IS NOT NULL, 1, 0)) TOTAL_HEALTH_CARE_WORKERS_EMPLOYED,
	  COUNT(S.ID) TOTAL_NUMBER_OF_SHIPMENTS,
	  SUM(S.numberOfVaccinesRecieved) TOTAL_NUMBER_OF_VACCINES_RECEIVED,
	  SUM(T.numberOfVaccinesTransfered) TOTAL_NUMBER_OF_TRANSERS_FROM,
	  SUM(T2.numberOfVaccinesTransfered) TOTAL_NUMBER_OF_TRANSERS_TO,
	  COUNT(DISTINCT V.NAME) TOTAL_VACCINE_TYPES,
	  COUNT(DISTINCT VCN.patientID) TOTAL_NUMBER_OF_PEOPLE_VACCINATED,
	  COUNT(VCN.patientID) TOTAL_NUMBER_OF_DOSES_GIVEN
	FROM
	  Facility F
	  INNER JOIN Inventory I ON I.facilityID = F.ID
	  INNER JOIN Shipment S ON S.ID = I.shipmentID
	  INNER JOIN EmploymentRecord ER ON ER.facilityID = F.ID
	  INNER JOIN Transfer T ON T.fromfacilityID = F.ID
	  INNER JOIN Transfer T2 ON T2.tofacilityID = F.ID
	  INNER JOIN Vaccine V ON V.ID = S.vaccineID
	  INNER JOIN Vaccination VCN ON VCN.facilityID = F.ID
	WHERE
	  F.CITY = 'Montreal'
	GROUP BY
	  F.NAME,
	  F.ADDRESS,
	  F.TYPE,
	  PHONE
) t1
